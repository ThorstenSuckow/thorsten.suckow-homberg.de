(self.webpackChunkthorsten_suckow_homberg_de=self.webpackChunkthorsten_suckow_homberg_de||[]).push([[6829],{477:()=>{},2172:(e,n,s)=>{"use strict";s.d(n,{$z:()=>m,C9:()=>h,IX:()=>j,ZX:()=>x,eJ:()=>d,uR:()=>p});var a=s(6540),t=s(4882),r=s(8069),i=s(4945),l=s.n(i),o=s(2897),c=s(4848);function h(e){let{width:n,children:s,title:a,figure:r,modeAware:i}=e;return(0,c.jsxs)("div",{style:{width:n,textAlign:"center",margin:20},children:[(0,c.jsx)("div",{className:!1!==i?"umlImg":"",children:s}),(0,c.jsx)("div",{style:{textAlign:"center"},children:(0,c.jsxs)("sup",{children:[(0,c.jsx)("b",{children:t.A.isString(r)?r:`Figure ${r??1}`})," ",(0,c.jsx)("span",{dangerouslySetInnerHTML:{__html:a}})]})})]})}function d(e){let{id:n,source:s,title:a}=e;return(0,c.jsx)(h,{modeAware:!1,title:a,figure:`Source ${s}`,children:(0,c.jsx)(o.A,{id:n})})}function m(e){let{url:n,figure:s,title:a}=e;return(0,c.jsx)(h,{modeAware:!1,figure:s,title:a,children:(0,c.jsx)("img",{alt:"{title}",src:n})})}function p(e){let{children:n,figure:s,title:a}=e;return(0,c.jsx)(h,{modeAware:!0,figure:s,title:a,children:n})}function x(e){let{when:n,where:s}=e;const[a,t]=s;return(0,c.jsxs)("div",{children:["This article was originally published in ",n," at ",(0,c.jsx)("a",{target:"_blank",href:t,children:a}),". Some formatting might have get lost during the migration to this site: If you think you spotted an issue caused by malformed formatting, feel free to open a ",(0,c.jsx)("a",{href:"https://github.com/ThorstenSuckow/thorsten.suckow-homberg.de",children:"Pull Request"})," or ",(0,c.jsx)("a",{href:"mailto:thorsten@suckow-homberg.de",children:"send me an Email"}),"."]})}function j(e){let{url:n}=e;const[s,t]=a.useState("");return l()(n).then((e=>{e.text().then((e=>t(e)))})),(0,c.jsx)(r.A,{language:"php",children:s})}},2253:(e,n,s)=>{"use strict";s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"articles/using-php-enums-as-method-calls/index","title":"Using PHP enums as method calls","description":"Dynamically mapping method calls to existing typed values.","source":"@site/docs/articles/using-php-enums-as-method-calls/index.mdx","sourceDirName":"articles/using-php-enums-as-method-calls","slug":"/articles/using-php-enums-as-method-calls/","permalink":"/docs/articles/using-php-enums-as-method-calls/","draft":false,"unlisted":false,"editUrl":"https://github.com/thorstensuckow/thorsten.suckow-homberg.de/tree/main/docs/articles/using-php-enums-as-method-calls/index.mdx","tags":[],"version":"current","lastUpdatedBy":"Thorsten Suckow-Homberg","lastUpdatedAt":1745694816000,"frontMatter":{"title":"Using PHP enums as method calls"},"sidebar":"docs","previous":{"title":"Ext JS - Beyond ES5","permalink":"/docs/articles/sencha-extjs-beyond-es5/"},"next":{"title":"Downloadable Assets with GitHub Actions","permalink":"/docs/articles/downloadable-assets-with-github-actions/"}}');var t=s(4848),r=s(8453),i=s(2897),l=s(2172);const o={title:"Using PHP enums as method calls"},c=void 0,h={},d=[{value:"Motivation",id:"motivation",level:2},{value:"What are filters, anyway? (Spoiler: Expressions, of course)",id:"what-are-filters-anyway-spoiler-expressions-of-course",level:2},{value:"The OOP modelling approach",id:"the-oop-modelling-approach",level:2},{value:"Silence is golden: Refactoring into a factory",id:"silence-is-golden-refactoring-into-a-factory",level:3},{value:"Using enums for method calls",id:"using-enums-for-method-calls",level:2},{value:"Stargazing __callStatic()",id:"stargazing-__callstatic",level:3},{value:"Dynamically resolving members with constant()",id:"dynamically-resolving-members-with-constant",level:3},{value:"Final implementation",id:"final-implementation",level:2}];function m(e){const n={a:"a",admonition:"admonition",annotation:"annotation",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Dynamically mapping method calls to existing typed values."})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(l.ZX,{when:"October 2022",where:["medium.com","https://medium.com/@thorstensuckow/using-php-enums-as-method-calls-2d6b95fa8347"]})}),"\n",(0,t.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,t.jsxs)(n.p,{children:["Large parts of the ",(0,t.jsx)(n.a,{href:"https://conjoon.org",children:"conjoon"})," backend are currently being reworked to meet compliance with the ",(0,t.jsxs)(n.a,{href:"https://jsonapi.org/format/",children:["**JSON",":API"]}),"**. This is so the webmail\u2019s RESTful API provides consistency between requests and responses across various endpoints and provides a familiar environment for developers already using the JSON",":API"," (or similar ",(0,t.jsx)(n.a,{href:"https://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven",children:"HATEOAS "}),"driven APIs) with other projects."]}),"\n",(0,t.jsxs)(n.p,{children:["One challenge in adopting parts of the specification was not only the exclusion of fields (which ultimately culminated in the ",(0,t.jsxs)(n.a,{href:"https://github.com/ThorstenSuckow/relfield",children:["RFC for the ",(0,t.jsx)(n.strong,{children:"relfield"}),"-extension"]})," ), but also in finding a way to pass meaningful filter-configurations from the client to the server."]}),"\n",(0,t.jsxs)(n.p,{children:["Right now, the client can pass filter options in query parameters. Those query parameters need to be validated and get translated into their OOP representation, so that string-representations of the ",(0,t.jsx)(n.strong,{children:"Filter"}),"-objects can be passed to connected IMAP servers in a format ",(0,t.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc3501#page-49",children:"the protocol understands"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"what-are-filters-anyway-spoiler-expressions-of-course",children:"What are filters, anyway? (Spoiler: Expressions, of course)"}),"\n",(0,t.jsxs)(n.p,{children:["A filter (or ",(0,t.jsx)(n.em,{children:"search query"}),") consists of ",(0,t.jsx)(n.strong,{children:"logical"}),", **functional **and ",(0,t.jsx)(n.strong,{children:"relational expressions"}),", and an expression in turn has ",(0,t.jsx)(n.strong,{children:"operands"})," and **operators (**hint: ****an operator can also be an expressions)."]}),"\n",(0,t.jsxs)(n.p,{children:["The following represents a request for all emails that have a date set to the ",(0,t.jsx)(n.em,{children:"9th of October 2022"})," or before (missing percent-encoded characters in favor of readability):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-http",children:'    GET /MessageItems?filter={"<":{"date":1665375431}} HTTP/1.1\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The above example has a *relational *operator (",(0,t.jsx)(n.code,{children:"<"}),", ",(0,t.jsx)(n.em,{children:"less than"}),"), and has two ",(0,t.jsx)(n.em,{children:"operands"}),": A name representing the name of the field the filter applies to (date), and an integer value representing the timestamp for comparison (1665375431)."]}),"\n",(0,t.jsx)(n.h2,{id:"the-oop-modelling-approach",children:"The OOP modelling approach"}),"\n",(0,t.jsx)(n.p,{children:"Mathematical expressions are fairly easy to model. Their symbols can be abstracted into the following **UML **diagram:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://cdn-images-1.medium.com/max/2000/1*dZJ6ccRLqaoDZC3Up_hPcA.png",alt:"A simplified UML diagram for an expression. Note how an expression is also an operand."})}),"\n",(0,t.jsx)(n.p,{children:"An expression can be a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["a ",(0,t.jsx)(n.strong,{children:"Relational Expression"})," providing relational operators: ",(0,t.jsx)(n.code,{children:"<, >, <=, >=, ==, !="})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["a ",(0,t.jsx)(n.strong,{children:"Logical Expression"})," providing logical operators: &&, ||, !"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["a ",(0,t.jsx)(n.strong,{children:"Functional Expression"})," providing arbitrary function names, such as IN"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Furthermore, each expression is associated with one or more ",(0,t.jsx)(n.strong,{children:"Operands"}),": An expression using a logical operator representing a negation (!) has only one operand, while a logical *disjunction *or *conjunction *must have two or more operands:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"    ! 5 // logical negation operator has one operand\n\n    // a logical conjunction can have an arbitrary\n    // number of operands:\n    true && false && true\n\n    // logical disjunction with two operands\n    true || false\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Further implementation details of how ",(0,t.jsx)(n.a,{href:"https://github.com/conjoon/php-lib-conjoon",children:"php-lib-conjoon"})," models Expressions would go beyond the scope of this article. We\u2019ll focus on how to use them in the code. Here\u2019s an example for an expression that represents date < 1665375431. Note how the order of parameters for the constructor is in accordance with the ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Polish_notation",children:"**Polish Notation"}),"**, starting with the operator, then followed by the operands (< date 1665375431):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    $expression = new RelationalExpression(\n        RelationalExpression::LESS_THAN,\n        new VariableName("date"),\n        new Value(1665375431)\n    );\n    $expression->toString() // produces "date < 1665375431"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"silence-is-golden-refactoring-into-a-factory",children:"Silence is golden: Refactoring into a factory"}),"\n",(0,t.jsxs)(n.p,{children:["The above example is \u2014 while still readable and maintainable \u2014 too verbose. Code readability is king (see also my article about ",(0,t.jsx)(n.a,{href:"https://medium.com/@thorstensuckow/a-fluent-interface-for-javascript-promises-372ffc40e051",children:"fluent interfaces"}),") so let\u2019s pour some syntactical sugar into the code:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    $expression = RelationalExpression::lessThan(\n        VariableName::make("date"),\n        Value::make(1665375431)\n    );\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This would allow us to omit calls to the constructor of the ",(0,t.jsx)(n.strong,{children:"RelationalExpression"}),", while still getting an expression as a return value from the factory method ."]}),"\n",(0,t.jsxs)(n.p,{children:["However, this would make it also necessary to implement static methods matching available operators used by the Expression-specific we\u2019re currently using. Given six relational operators ",(0,t.jsx)(n.code,{children:">, <, >=, <=,=, !="})," , we\u2019d have to add six factory methods to our class (while prototyping, without refactoring and code optimizations):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"    class RelationalExpression extends Expression {\n\n        /**\n         * Constructor.\n         */\n        public function __construct(\n            RelationalOperator $operator,\n            OperandList $operands\n        ) {\n\n           // ...\n        }\n\n\n        /**\n         * Builds a RelationalExpression for the\n         * RelationalOperator::LESS_THAN\n         *\n         * @param Operand $lft\n         * @param Operand $rt\n         *\n         * @return RelationalExpression\n         */\n        public static function lessThan(\n            Operand $lft,\n            Operand $rt\n        ): RelationalExpression\n        {\n           $operands = OperandList::make($lft, $rt);\n           return new self(RelationalOperator::LESS_THAN, $operands);\n        }\n\n\n        // ... additional implementations for the remaining operators\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["However, adding a new operator would require us to also add another function to the ",(0,t.jsx)(n.strong,{children:"RelationalExpression"})," \u2014dependencies pop up where they shouldn\u2019t and the code base grows unnecessarily, containing redundant code."]}),"\n",(0,t.jsx)(n.h2,{id:"using-enums-for-method-calls",children:"Using enums for method calls"}),"\n",(0,t.jsxs)(n.p,{children:["Since we already have ",(0,t.jsx)(n.strong,{children:"enums"})," representing Operators, we\u2019re looking for a way to reuse them \u2014 not only as a closed set for typed values, but also for method calls. Here\u2019s how the **enum **definition for **RelationalOperator **looks like (similar implementations are available for **LogicalOperator **and ",(0,t.jsx)(n.strong,{children:"FunctionalOperator)"}),":"]}),"\n",(0,t.jsx)(l.C9,{modeAware:!1,figure:"Source 1",children:(0,t.jsx)(i.A,{id:"a52254400a069aeb3dba466af316c1a6"})}),"\n",(0,t.jsxs)(n.p,{children:["\u2026 and here\u2019s what we want to achieve since we already have an existing list of operators given the ",(0,t.jsx)(n.strong,{children:"enum"}),"-definition:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    RelationalExpression::LESS_THAN(\n        VariableName::make("date"),\n        Value::make(1665375431)\n    );\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note how we statically call the ",(0,t.jsx)(n.strong,{children:"enum"}),"\u2019s name on the ",(0,t.jsx)(n.strong,{children:"Expression"}),"(!) class \u2014 not the operator enum itself. It\u2019s the only line of code where the operator is mentioned. We know from the UML diagram above that an expression has an operator \u2014 we should be able to implement some kind of process looking up the association (our expression knows at least what type of operator it is *associated *with). The ",(0,t.jsx)(n.strong,{children:"Expression"}),"\u2019s implementation needs to check if the **enum **exists, and if that is the case, build the expression. Here\u2019s the ",(0,t.jsx)(n.a,{href:"https://phpunit.de/",children:"PHPUnit"})," test case for this implementation:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    $lft = VariableName::make("date");\n    $rt  = Value::make(1665375431);\n\n    $expression = RelationalExpression::LESS_THAN($lft, $rt);\n\n    $this->assertInstanceOf(RelationalExpression::class, $expression);\n    $this->assertSame(\n        RelationalOperator::LESS_THAN,\n        $expression->getOperator()\n    );\n    $this->assertSame($lft, $expression->getOperands()[0]);\n    $this->assertSame($rt, $expression->getOperands()[1]);\n'})}),"\n",(0,t.jsx)(n.p,{children:"Furthermore, we expect calls to non-existing operators to throw exceptions of the type BadMethodCallException:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"    $this->expectException(BadMethodCallException::class);\n    RelationalExpression::MISSING();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"stargazing-__callstatic",children:"Stargazing __callStatic()"}),"\n",(0,t.jsxs)(n.p,{children:["PHP provides ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/language.oop5.magic.php",children:"magic methods"})," that allow for intercepting calls to methods or members which are not explicitly defined in a target-class or -object, and then invoke specific logic if available and applicable. One example for a magic method would be ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/language.oop5.overloading.php#object.call",children:"__call()"})," \u2014 it is often used with DTOs where a large number of properties would require a lot of effort for writing matching *getters *and ",(0,t.jsx)(n.em,{children:"setters"}),". It\u2019s lesser known (righteous because: testability of static methods ",(0,t.jsx)(n.a,{href:"https://github.com/sebastianbergmann/phpunit-documentation/issues/77",children:"is lacking"}),") pendant for calls for static methods is ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/language.oop5.overloading.php#object.callstatic",children:"__callStatic()"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Since we want to use a ",(0,t.jsx)(n.a,{href:"https://medium.com/javarevisited/static-factory-methods-an-alternative-to-public-constructors-73cbe8b9fda",children:"static factory method"})," in our **Expression-specific ",(0,t.jsxs)(n.strong,{children:["(e.g. ",(0,t.jsx)(n.strong,{children:"RelationalExpression"}),")"]})," **target class, let\u2019s see how we can map calls to all of the existing ",(0,t.jsx)(n.strong,{children:"RelationalOperator"}),"s with a single method:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    public static function __callStatic(\n        string $methodName,\n        array $arguments\n    ) {\n\n        $operator = null;\n\n        switch ($methodName) {\n           case "LESS_THAN":\n               $operator = RelationalOperator::LESS_THAN;\n           break;\n\n           case "GREATER_THAN":\n               $operator = RelationalOperator::LESS_THAN;\n           break;\n\n           case "LESS_THAN_OR_EQUAL":\n               $operator = RelationalOperator::LESS_THAN_OR_EQUAL;\n           break;\n\n           case "GREATER_THAN_OR_EQUAL":\n               $operator = RelationalOperator::GREATER_THAN_OR_EQUAL;\n           break;\n\n           case "IS":\n               $operator = RelationalOperator::IS;\n           break;\n\n           case "IS_NOT":\n               $operator = RelationalOperator::IS_NOT;\n           break;\n       }\n\n       if (!$operator) {\n           throw new BadMethodCallException(\n               "{$methodName} not found in RelationalExpression"\n\n           );\n      }\n\n      return new self($operator, OperandList::*make*(...$arguments));\n\n    }\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The method signature (including the parameter list) for __callStatic() should be self explanatory. We are actively mapping the ",(0,t.jsx)(n.em,{children:"name"})," of the method that is statically called on the ",(0,t.jsx)(n.strong,{children:"RelationalExpression"})," with the list of existing ",(0,t.jsx)(n.strong,{children:"RelationalOperators"})," in the *switch *statement."]}),"\n",(0,t.jsxs)(n.p,{children:["While we have code in one function here (and therefor reduce code complexity), adding operators to the ",(0,t.jsx)(n.strong,{children:"RelationalOperators"}),"-enum would still mean that we\u2019d have to adjust the *switch *statement \u2014 we\u2019re still maintaining two files for one small change. Let\u2019s finalize the implementation with the help of constant()."]}),"\n",(0,t.jsx)(n.h3,{id:"dynamically-resolving-members-with-constant",children:"Dynamically resolving members with constant()"}),"\n",(0,t.jsx)(n.p,{children:"Our current implementation already fulfills most of the requirements, yet fails with dynamically resolving the typed value represented by the called method. Let\u2019s remove the problematic code and revert to a basic function template which we will adjust shortly:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:"    public static function __callStatic(\n        string $method,\n        array $arguments\n    )\n    {\n        $method = strtoupper($method);\n\n        // ... resolve $method to $operator\n\n        return new static(\n            $operator,\n            OperandList::make(...$arguments)\n        );\n    }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The goal is to resolve ",(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mi,{children:"m"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"h"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"d"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"n"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"x"}),(0,t.jsx)(n.mi,{children:"i"}),(0,t.jsx)(n.mi,{children:"s"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"i"}),(0,t.jsx)(n.mi,{children:"n"}),(0,t.jsx)(n.mi,{children:"g"}),(0,t.jsx)(n.mi,{children:"O"}),(0,t.jsx)(n.mi,{children:"p"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"p"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"s"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"n"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"d"}),(0,t.jsx)(n.mi,{children:"b"}),(0,t.jsx)(n.mi,{children:"y"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"h"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"v"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"i"}),(0,t.jsx)(n.mi,{children:"l"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"b"}),(0,t.jsx)(n.mi,{children:"l"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mo,{children:"\u2217"}),(0,t.jsx)(n.mo,{children:"\u2217"}),(0,t.jsx)(n.mi,{children:"R"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"l"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"i"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"n"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"l"}),(0,t.jsx)(n.mi,{children:"O"}),(0,t.jsx)(n.mi,{children:"p"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mo,{children:"\u2217"}),(0,t.jsx)(n.mo,{children:"\u2217"}),(0,t.jsx)(n.mi,{mathvariant:"normal",children:"."}),(0,t.jsx)(n.mi,{children:"W"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"l"}),(0,t.jsx)(n.mi,{children:"r"}),(0,t.jsx)(n.mi,{children:"e"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"d"}),(0,t.jsx)(n.mi,{children:"y"}),(0,t.jsx)(n.mi,{children:"k"}),(0,t.jsx)(n.mi,{children:"n"}),(0,t.jsx)(n.mi,{children:"o"}),(0,t.jsx)(n.mi,{children:"w"}),(0,t.jsx)(n.mi,{children:"t"}),(0,t.jsx)(n.mi,{children:"h"}),(0,t.jsx)(n.mi,{children:"a"}),(0,t.jsx)(n.mi,{children:"t"})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"method to an existing Operator represented by the available **RelationalOperator**. We already know that "})]})})}),(0,t.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"m"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"an"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"i"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"s"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"in"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"Op"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"orre"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"rese"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"n"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"b"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"h"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"v"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"ai"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"ab"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(n.span,{className:"mbin",children:"\u2217"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(n.span,{className:"mord",children:"\u2217"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"i"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"na"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"lOp"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"er"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"or"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(n.span,{className:"mbin",children:"\u2217"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(n.span,{className:"mord",children:"\u2217"}),(0,t.jsx)(n.span,{className:"mord",children:"."}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"W"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"e"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.01968em"},children:"l"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"re"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"a"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"d"}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"kn"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"o"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"wt"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"ha"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"t"})]})]})]}),"method is (optimistically) one of the values defined within the associated ",(0,t.jsx)(n.strong,{children:"enum"}),". However, it\u2019s of the type ",(0,t.jsx)(n.em,{children:"string"}),", and we have to look up if this string represents an enum value. Here\u2019s all the information we have:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["RelationalOperator::class \u2014 the class name of ",(0,t.jsx)(n.strong,{children:"RelationalOperator"})," as the ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Fully_qualified_name",children:"fqn"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["$method \u2014 the name of the static method being called on ",(0,t.jsx)(n.strong,{children:"RelationalExpression"}),"; it\u2019s intercepted by __callStatic() and its value has to be mapped to an enum-value in ",(0,t.jsx)(n.strong,{children:"RelationalOperator"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["One approach would be to to use ",(0,t.jsx)(n.em,{children:"string concatenation"})," and hope for a value that resolves to an existing enum value:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    $operator = RelationalOperator::class . "::$method";\n\n    gettype($operator); // "string"\n    operator instanceof RelationalOperator; // false\n'})}),"\n",(0,t.jsx)(n.p,{children:"While this does not throw an error, $operator is in it\u2019s current form not usable: The value is a string in the form of fqn::enum_value, e.g. Statement\\Expression\\RelationalOperator::LESS_THAN . However, with the help of a specific function, we can produce the result we\u2019re looking for."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:[(0,t.jsx)(n.em,{children:"constant()"})," is useful if you need to retrieve the value of a constant, but do not know its name. I.e. it is stored in a variable or returned by a function. (",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/function.constant.php",children:"php.net"}),")"]})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["We know that the string available with $operator holds the *fqn *of an existing ",(0,t.jsx)(n.em,{children:"typed value"}),"; we just need to make use of PHP\u2019s ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/function.constant.php",children:"constant()"})," to be able to access the enum value this string represents."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["Because cases are represented as constants on the enum itself, they may be used as static values in most constant expressions: property defaults, static variable defaults, parameter defaults, global and class constant values. ",(0,t.jsx)(n.a,{href:"https://wiki.php.net/rfc/enumerations",children:"(enum RFC)"})]})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We just have to pass the value of the right-hand operand as the argument to constant() , then assign its return value to the left-hand operand:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    $operator = constant(RelationalOperator::class . "::$method");\n\n    gettype($operator); // "object"\n    operator instanceof RelationalOperator; // true\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here\u2019s the final, working implementation for the __callStatic()-method. It includes re-throwing any occurring **Error **as a ",(0,t.jsx)(n.strong,{children:"BadMethodCallException"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-php",children:'    public static function __callStatic(\n        string $method,\n        array $arguments\n    )\n    {\n        $method = strtoupper($method);\n\n        $operator = self::*getOperatorClass*() . "::$method";\n\n        try {\n            $operator = constant(\n                RelationalOperator::class . "::$method"\n            );\n        } catch (Error $error) {\n            throw new BadMethodCallException(\n                "{$method} does not exist: " . $error->getMessage()\n            );\n        }\n\n        return new self(\n            $operator,\n            OperandList::*make*(...$arguments)\n        );\n    }\n'})}),"\n",(0,t.jsx)(n.h2,{id:"final-implementation",children:"Final implementation"}),"\n",(0,t.jsxs)(n.p,{children:["Since the functionality is also used with **LogicalExpression **and ",(0,t.jsx)(n.strong,{children:"FunctionalExpression"}),", the method above was refactored into a ",(0,t.jsx)(n.a,{href:"https://www.php.net/manual/en/language.oop5.traits.php",children:"trait"}),". Traits also allow for defining abstract methods so there\u2019s a contract added to make sure implementing classes provide information about the ",(0,t.jsx)(n.strong,{children:"Operator"}),"\u2019s type."]}),"\n",(0,t.jsx)(l.C9,{modeAware:!1,figure:"Source 2",children:(0,t.jsx)(i.A,{id:"65396b1f1912dac56a4c705395401f85"})}),"\n",(0,t.jsx)(n.p,{children:"Note:"}),"\n",(0,t.jsxs)(n.p,{children:["In its current form, the functionality could also be implemented in the ",(0,t.jsx)(n.strong,{children:"Expression"}),"-class. I would not treat this kind of functionality as existential for the ",(0,t.jsx)(n.strong,{children:"Expression"}),"-type, this is why it\u2019s decoupled into a trait."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(m,{...e})}):m(e)}},8453:(e,n,s)=>{"use strict";s.d(n,{R:()=>i,x:()=>l});var a=s(6540);const t={},r=a.createContext(t);function i(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);