(self.webpackChunkthorsten_suckow_homberg_de=self.webpackChunkthorsten_suckow_homberg_de||[]).push([[7312],{477:()=>{},2172:(e,t,n)=>{"use strict";n.d(t,{$z:()=>m,C9:()=>g,IX:()=>j,JP:()=>h,ZX:()=>f,eJ:()=>u,uR:()=>x});var s=n(6540),r=n(4882),i=n(8069),a=n(4945),o=n.n(a),l=n(2897),c=n(4843),d=n(4848);function g(e){let{width:t,children:n,title:s,figure:i,modeAware:a}=e;return(0,d.jsxs)("div",{style:{width:t,textAlign:"center",margin:20},children:[(0,d.jsx)("div",{className:!1!==a?"umlImg":"",children:n}),(0,d.jsx)("div",{style:{textAlign:"center"},children:(0,d.jsxs)("sup",{children:[(0,d.jsx)("b",{children:r.A.isString(i)?i:`Figure ${i??1}`})," ",(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:s}})]})})]})}function h(e){let{width:t,children:n,title:s,figure:i,modeAware:a,pp:o,name:l}=e;return(0,d.jsxs)("div",{style:{width:t,textAlign:"center",margin:20},children:[(0,d.jsx)("div",{className:!1!==a?"umlImg":"",children:n}),(0,d.jsx)("div",{style:{textAlign:"center"},children:(0,d.jsxs)("sup",{children:[(0,d.jsx)("b",{children:r.A.isString(i)?i:`Figure ${i??1}`})," ",(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:s}})," (Quelle: in Anlehnung an ",(0,d.jsx)(c.I8,{pp:o,name:l}),")"]})})]})}function u(e){let{id:t,source:n,title:s}=e;return(0,d.jsx)(g,{modeAware:!1,title:s,figure:`Source ${n}`,children:(0,d.jsx)(l.A,{id:t})})}function m(e){let{url:t,figure:n,title:s}=e;return(0,d.jsx)(g,{modeAware:!1,figure:n,title:s,children:(0,d.jsx)("img",{alt:"{title}",src:t})})}function x(e){let{children:t,figure:n,title:s}=e;return(0,d.jsx)(g,{modeAware:!0,figure:n,title:s,children:t})}function f(e){let{when:t,where:n}=e;const[s,r]=n;return(0,d.jsxs)("div",{children:["This article was originally published in ",t," at ",(0,d.jsx)("a",{target:"_blank",href:r,children:s}),". Some formatting might have get lost during the migration to this site: If you think you spotted an issue caused by malformed formatting, feel free to open a ",(0,d.jsx)("a",{href:"https://github.com/ThorstenSuckow/thorsten.suckow-homberg.de",children:"Pull Request"})," or ",(0,d.jsx)("a",{href:"mailto:thorsten@suckow-homberg.de",children:"send me an Email"}),"."]})}function j(e){let{url:t}=e;const[n,r]=s.useState("");return o()(t).then((e=>{e.text().then((e=>r(e)))})),(0,d.jsx)(i.A,{language:"php",children:n})}},4843:(e,t,n)=>{"use strict";n.d(t,{I8:()=>i,R5:()=>r,lA:()=>o,rd:()=>a});n(6540);var s=n(4848);function r(e){let{name:t,pp:n}=e;const r=`/docs/bibliography#${t.toLowerCase()}`;return(0,s.jsxs)("a",{href:r,children:["[",(0,s.jsxs)("span",{className:"bibRef",children:["\ud83d\udcd6",t]}),n?`, ${n.includes("-")?"pp":"p"}. ${n}`:"","]"]})}function i(e){let{name:t,pp:n}=e;const r=`/docs/bibliography#${t.toLowerCase()}`;return(0,s.jsxs)("a",{href:r,children:["[",(0,s.jsxs)("span",{className:"bibRef",children:["\ud83d\udcd6",t]}),n?`, ${n.includes("-")?"pp":"p"}. ${n}`:"","]"]})}function a(e){let{idx:t}=e;return(0,s.jsxs)("a",{href:"#fig_{idx}",children:["[",(0,s.jsxs)("span",{className:"bibRef",children:["Abbildung ",t]})]})}function o(e){let{name:t,file:n}=e;Object.entries({sd:"softwaredesign",sa:"softwarearchitecture",cs:"computerscience"}).some((e=>{let[t,s]=e;if(n.startsWith(`${t}.`))return n=n.replace(`${t}.`,`${s}.`),!0}));const r=`/docs/toolbox/${n}`;return(0,s.jsx)("a",{href:r,className:"glosRef",children:t})}},5142:(e,t,n)=>{"use strict";n.d(t,{o:()=>r});n(6540);var s=n(4848);function r(){return(0,s.jsx)("div",{style:{width:"100%",textAlign:"right"},children:(0,s.jsx)("a",{style:{textDecoration:"underline"},onClick:()=>history.go(-1),href:"#",children:"Back"})})}},6900:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"toolbox/ddd.aggregate","title":"Aggregate","description":"An Aggregate is an abstraction for an object that is important and of value to the business of its domain. It is often referred to as a \\"cluster\\" of objects, because it is modelled as a whole/parts-relationship holding  between  and .","source":"@site/docs/toolbox/ddd.aggregate.mdx","sourceDirName":"toolbox","slug":"/toolbox/ddd.aggregate","permalink":"/docs/toolbox/ddd.aggregate","draft":false,"unlisted":false,"editUrl":"https://github.com/thorstensuckow/thorsten.suckow-homberg.de/tree/main/docs/toolbox/ddd.aggregate.mdx","tags":[],"version":"current","lastUpdatedBy":"Thorsten Suckow-Homberg","lastUpdatedAt":1745965967000,"frontMatter":{"title":"Aggregate"},"sidebar":"toolbox","previous":{"title":"Actor","permalink":"/docs/toolbox/uml.actor"},"next":{"title":"Aggregation","permalink":"/docs/toolbox/uml.aggregation"}}');var r=n(4848),i=n(8453),a=(n(5142),n(4843)),o=n(2172);const l=n.p+"assets/images/email-aggregate.svg-8218524dbdc754f0f9945b6a6b81c1ce.png",c={title:"Aggregate"},d="Aggregate (DDD)",g={},h=[{value:"Aggregate Root",id:"aggregate-root",level:2},{value:"Invariants",id:"invariants",level:2},{value:"Transactional Consistency",id:"transactional-consistency",level:2}];function u(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"aggregate-ddd",children:"Aggregate (DDD)"})}),"\n",(0,r.jsxs)(t.p,{children:["An ",(0,r.jsx)(t.strong,{children:"Aggregate"}),' is an abstraction for an object that is important and of value to the business of its domain. It is often referred to as a "cluster" of objects, because it is modelled as a ',(0,r.jsx)(t.strong,{children:"whole/parts"}),"-relationship holding ",(0,r.jsx)(a.lA,{name:"Associations",file:"uml.association"})," between ",(0,r.jsx)(a.lA,{name:"Entities",file:"sd.entity"})," and ",(0,r.jsx)(a.lA,{name:"Value Objects",file:"sd.valueobject"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Aggregates"})," are not to be understood as data-structures: They have particularly responsibility for carrying out and applying logic and behavior characteristic to the ",(0,r.jsx)(a.lA,{name:"Bounded Context",file:"ddd.boundedcontext"})," they belong to."]}),"\n",(0,r.jsxs)(t.p,{children:["An ",(0,r.jsx)(t.strong,{children:"Aggregate"})," is uniquely identifiable given high-level code semantics, e.g. through (one of) its attributes."]}),"\n","\n",(0,r.jsx)(o.C9,{figure:1,title:"An Email modeled as an Aggregate",children:(0,r.jsx)("img",{src:l})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Figure 1"})," depicts the ",(0,r.jsx)(t.strong,{children:"Aggregate"}),"-model of an ",(0,r.jsx)(t.strong,{children:"Email"}),". This model suggests a simpification of an ",(0,r.jsx)(t.strong,{children:"Email"}),"-message in a way that clients do not have to be aware of the intricate structure ",(0,r.jsx)(t.a,{href:"https://www.rfc-editor.org/rfc/rfc2822",children:"[RFC2822]"})," of an Email, but rather can add and remove attachments, edit its message body and update header fields given the interface provided by the ",(0,r.jsx)(t.strong,{children:"Aggregate Root"}),", ",(0,r.jsx)(t.code,{children:"Email"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Another ",(0,r.jsx)(t.strong,{children:"Aggregate"})," in form of the ",(0,r.jsx)(t.code,{children:"Mailbox"})," (i.e. the folder that owns the ",(0,r.jsx)(t.code,{children:"Email"}),") can provide access to its ",(0,r.jsx)(t.code,{children:"Emails"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"aggregate-root",children:"Aggregate Root"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.strong,{children:"root"})," of the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," ",(0,r.jsx)(t.em,{children:"guards the objects"})," of the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," and is the only object that grants access to its elements. It is also responsible for making sure that any ",(0,r.jsx)(t.strong,{children:"Aggregate"}),"-defining ",(0,r.jsx)(t.strong,{children:"invariants"})," are not violated when business logic is applied, or during creation or reconstitution from a persistent state."]}),"\n",(0,r.jsxs)(t.p,{children:["Identities of such embedded objects are often only of importance ",(0,r.jsx)(t.em,{children:"within and to the Aggregate"}),". Thus, an ",(0,r.jsx)(t.strong,{children:"Aggegrate"})," also designates a ",(0,r.jsx)(t.strong,{children:"consistency boundary"})," so that parts of the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," may not be accessed from outside to ",(0,r.jsx)(t.em,{children:"prevent violating"})," the consistency. Control must only be given by the ",(0,r.jsx)(t.strong,{children:"Aggregate Root"}),".\nIn such cases, it is preferable to satisfy interested clients with transient references, often in the form of ",(0,r.jsx)(a.lA,{name:"Value Objects",file:"sd.valueobject"})," so any state of the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," does not get accidentally changed, e.g. through ",(0,r.jsx)(a.lA,{name:"Aliasing Bugs",file:"cs.aliasing#aliasing-bugs"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"invariants",children:"Invariants"}),"\n",(0,r.jsxs)(t.p,{children:["Invariants for the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," are rules that apply to the ",(0,r.jsx)(t.strong,{children:"whole"})," and are validated against its ",(0,r.jsx)(t.strong,{children:"parts"}),". The state of the ",(0,r.jsx)(t.strong,{children:"Aggregate"})," is only valid if no ",(0,r.jsx)(t.strong,{children:"invariant"})," is violated. ",(0,r.jsx)(t.strong,{children:"Invariants"})," can be simple checks which make sure that the format of field-values is valid, or more complex ones where specifications encapsulate business rules."]}),"\n",(0,r.jsx)(t.h2,{id:"transactional-consistency",children:"Transactional Consistency"}),"\n",(0,r.jsxs)(t.p,{children:["When the state of an ",(0,r.jsx)(t.strong,{children:"Aggregate"})," is persisted, the whole ",(0,r.jsx)(t.strong,{children:"Aggregate"})," must be committed, including any changes made to the state of its ",(0,r.jsx)(t.strong,{children:"parts"}),". The implementation has to make sure that affected ",(0,r.jsx)(t.strong,{children:"Aggregates"})," are updated using appropriate methodologies, such as ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(a.lA,{name:"Eventual Consistency",file:"sd.eventualconsistency"})}),". The design of the **Aggregate should make sure that the boundaries of such conceptual related abstractions are meaningful to the model as well as the system, where non-functional requirements such as scalability and performance also apply."]}),"\n",(0,r.jsxs)(t.admonition,{title:"Aggregates are not Object Graphs",type:"tip",children:[(0,r.jsxs)(t.p,{children:["It is suggested to design ",(0,r.jsx)(t.strong,{children:"Aggregates"})," small: They should ",(0,r.jsx)(t.em,{children:"not"})," become ",(0,r.jsx)(t.strong,{children:"object graphs"})," of (large) relational models, but it should also be taken care of meaningful ",(0,r.jsx)(t.strong,{children:"transactional boundaries"}),": Committing changes of an ",(0,r.jsx)(t.strong,{children:"Aggregate"})," should not require the update a large number of fine-granular conceptual related ",(0,r.jsx)(t.strong,{children:"Aggregates"}),". The existence of such aggregates should be questioned and reconciled with the model that triggered the state-change in the first place. On the other hand, such a transaction should not lock the data-model down so that concurrent operations on related ",(0,r.jsx)(t.strong,{children:"Aggregates"})," are not put to an hold."]}),(0,r.jsxs)(t.p,{children:["Questions that can help with designing ",(0,r.jsx)(t.strong,{children:"Aggregates"})," are, amongst others:"]}),(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["How many transactions are required to successfully commit changes to the ",(0,r.jsx)(t.strong,{children:"Aggregate"}),"?"]}),"\n",(0,r.jsx)(t.li,{children:"What are the transactional boundaries?"}),"\n",(0,r.jsxs)(t.li,{children:["Are there any invariants redundant to invariants of other conceptual related ",(0,r.jsx)(t.strong,{children:"Aggregates"}),"?"]}),"\n"]}),(0,r.jsxs)(t.p,{children:["A detailed discussion on designing ",(0,r.jsx)(t.strong,{children:"Aggregates"})," is given with ",(0,r.jsx)(a.R5,{name:"IDDD",pp:"347-388"}),"."]}),(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.em,{children:'"(Therefore,) Aggregates are (chiefly) about consistency boundaries and not\ndriven by a desire to design object graphs."'})," ",(0,r.jsx)(a.R5,{name:"IDDD",pp:"355"})]})]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.p,{children:"references"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/domain-model-layer-validations",children:'"Design validations in the domain model layer", Microsoft.com'})}),"\n"]})]})}function m(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,t,n)=>{"use strict";n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);