(self.webpackChunkthorsten_suckow_homberg_de=self.webpackChunkthorsten_suckow_homberg_de||[]).push([[9599],{3905:(e,t,n)=>{"use strict";n.d(t,{Zo:()=>m,kt:()=>u});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},m=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=l(n),h=r,u=c["".concat(p,".").concat(h)]||c[h]||d[h]||i;return n?a.createElement(u,s(s({ref:t},m),{},{components:n})):a.createElement(u,s({ref:t},m))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=h;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:r,s[1]=o;for(var l=2;l<i;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2490:(e,t,n)=>{"use strict";n.d(t,{$o:()=>m,_b:()=>d,cx:()=>l,e2:()=>c,in:()=>u,t2:()=>h});var a=n(7294),r=n(5075),i=n(9943),s=n(814),o=n(4098),p=n.n(o);function l(e){let{width:t,children:n,title:i,figure:s,modeAware:o}=e;return a.createElement("div",{style:{width:t,textAlign:"center",margin:20}},a.createElement("div",{className:!1!==o?"umlImg":""},n),a.createElement("div",{style:{textAlign:"center"}},a.createElement("sup",null,a.createElement("b",null,r.Z.isString(s)?s:`Figure ${s??1}`)," ",a.createElement("span",{dangerouslySetInnerHTML:{__html:i}}))))}function m(e){let{id:t,source:n,title:r}=e;return a.createElement(l,{modeAware:!1,title:r,figure:`Source ${n}`},a.createElement(i.Z,{id:t}))}function c(e){let{url:t,figure:n,title:r}=e;return a.createElement(l,{modeAware:!1,figure:n,title:r},a.createElement("img",{alt:"{title}",src:t}))}function d(e){let{children:t,figure:n,title:r}=e;return a.createElement(l,{modeAware:!0,figure:n,title:r,children:t})}function h(e){let{when:t,where:n}=e;const[r,i]=n;return a.createElement("div",null,"This article was originally published in ",t," at ",a.createElement("a",{target:"_blank",href:i},r),". Some formatting might have get lost during the migration to this site: If you think you spotted an issue caused by malformed formatting, feel free to open a ",a.createElement("a",{href:"https://github.com/ThorstenSuckow/thorsten.suckow-homberg.de"},"Pull Request")," or ",a.createElement("a",{href:"mailto:thorsten@suckow-homberg.de"},"send me an Email"),".")}function u(e){let{url:t}=e;const[n,r]=a.useState("");return p()(t).then((e=>{e.text().then((e=>r(e)))})),a.createElement(s.Z,{language:"php"},n)}},6739:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,E:()=>r});var a=n(7294);function r(e){let{name:t,pp:n}=e;const r=`/docs/bibliography#${t.toLowerCase()}`;return a.createElement("a",{href:r},"[",a.createElement("span",{className:"bibRef"},"\ud83d\udcd6",t),n?`, ${n.includes("-")?"pp":"p"}. ${n}`:"","]")}function i(e){let{name:t,file:n}=e;Object.entries({sd:"softwaredesign",sa:"softwarearchitecture",cs:"computerscience"}).some((e=>{let[t,a]=e;if(n.startsWith(`${t}.`))return n=n.replace(`${t}.`,`${a}.`),!0}));const r=`/docs/toolbox/${n}`;return a.createElement("a",{href:r,className:"glosRef"},t)}},8735:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>k,frontMatter:()=>p,metadata:()=>m,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),i=n(6739),s=n(2490);const o=n.p+"assets/images/scoping-127c9a674efc4d197c4bad443425ce1c.png",p={title:"Accessor Automation with PHP Attributes",description:"Getters and Guarded Setters Automation with PHP attributes"},l=void 0,m={unversionedId:"articles/getter-setter-automation-with-php-attributes/index",id:"articles/getter-setter-automation-with-php-attributes/index",title:"Accessor Automation with PHP Attributes",description:"Getters and Guarded Setters Automation with PHP attributes",source:"@site/docs/articles/getter-setter-automation-with-php-attributes/index.mdx",sourceDirName:"articles/getter-setter-automation-with-php-attributes",slug:"/articles/getter-setter-automation-with-php-attributes/",permalink:"/docs/articles/getter-setter-automation-with-php-attributes/",draft:!1,editUrl:"https://github.com/thorstensuckow/thorsten.suckow-homberg.de/tree/main/docs/articles/getter-setter-automation-with-php-attributes/index.mdx",tags:[],version:"current",lastUpdatedBy:"Thorsten Suckow-Homberg",lastUpdatedAt:1706997528,formattedLastUpdatedAt:"Feb 3, 2024",frontMatter:{title:"Accessor Automation with PHP Attributes",description:"Getters and Guarded Setters Automation with PHP attributes"},sidebar:"docs",previous:{title:"On Software Craftsmanship",permalink:"/docs/articles/software-craftsmanship/"},next:{title:"Introduction",permalink:"/docs/articles/agp-the-payroll-system/introduction"}},c={},d=[{value:"1. Abstract",id:"1-abstract",level:2},{value:"1.1 Notation",id:"11-notation",level:3},{value:"2. Introduction",id:"2-introduction",level:2},{value:"3. PHP Attributes",id:"3-php-attributes",level:2},{value:"4. The <code>AccessorTrait</code>",id:"4-the-accessortrait",level:2},{value:"4.1 Hosting the <code>AccessorTrait</code>",id:"41-hosting-the-accessortrait",level:3},{value:"4.2 Conditional Updates of Properties with Guards",id:"42-conditional-updates-of-properties-with-guards",level:3},{value:"4.3 Guarding constructor arguments",id:"43-guarding-constructor-arguments",level:3},{value:"4.4 Modifying access to <code>getters</code> and <code>setters</code>",id:"44-modifying-access-to-getters-and-setters",level:3},{value:"4.5 Inheritance and Scoping",id:"45-inheritance-and-scoping",level:3},{value:"4.6 Static Code Analysis",id:"46-static-code-analysis",level:3},{value:"5. Performance considerations",id:"5-performance-considerations",level:2},{value:"5.1 Benchmark Test Cases",id:"51-benchmark-test-cases",level:3},{value:"5.1.1 Benchmark Settings",id:"511-benchmark-settings",level:4},{value:"5.2 Results",id:"52-results",level:3},{value:"5.3 Observations",id:"53-observations",level:3},{value:"5.3.1 Memory Consumption",id:"531-memory-consumption",level:4},{value:"6. Conclusion",id:"6-conclusion",level:2},{value:"Resources",id:"resources",level:5}],h={toc:d},u="wrapper";function k(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"1-abstract"},"1. Abstract"),(0,r.kt)("p",null,"This article introduces ",(0,r.kt)("inlineCode",{parentName:"p"},"getter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setter")," automation in ",(0,r.kt)("strong",{parentName:"p"},"PHP")," based on ",(0,r.kt)("strong",{parentName:"p"},"Attributes"),", ",(0,r.kt)("strong",{parentName:"p"},"Traits"),"\nand ",(0,r.kt)("strong",{parentName:"p"},"Constructor Property Promotion")," for ",(0,r.kt)("strong",{parentName:"p"},"PHP >= 8.2")," and shows how boilerplate code can be reduced for classes that\nrequire property encapsulation while simultaneously considering custom logic with setters."),(0,r.kt)("p",null,"  In this regard, ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," are not physically existing with code. Instead, calls to such methods will be intercepted and processed by PHP."),(0,r.kt)("p",null,"If access modifiers are required with such automated ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters"),", an implementing system has to check whether\na client belongs to the scope allowed to call the access-modified ",(0,r.kt)("em",{parentName:"p"},"(sic)")," method. While ",(0,r.kt)("inlineCode",{parentName:"p"},"access modifiers")," are usually handled by the programming language's engine,\nthe article demonstrates the various challenges an implementer faces when moving such logic from low-level (engine) to high level (user defined) code."),(0,r.kt)("p",null,"The impacts of ",(0,r.kt)("inlineCode",{parentName:"p"},"getter"),"/ ",(0,r.kt)("inlineCode",{parentName:"p"},"setter")," automation on performance is illustrated with benchmarks comparing various implementation details."),(0,r.kt)("h3",{id:"11-notation"},"1.1 Notation"),(0,r.kt)("p",null,"Assume there is a typed property ",(0,r.kt)("inlineCode",{parentName:"p"},"T $employee"),". We may construct setters and getters such that ",(0,r.kt)("inlineCode",{parentName:"p"},"setEmployee(T $value)")," has write-access and ",(0,r.kt)("inlineCode",{parentName:"p"},"getEmployee(): T"),"\nhas read-access to ",(0,r.kt)("inlineCode",{parentName:"p"},"$employee"),", with the following implications:"),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"1.1.1")," In this article, the generalization of such ",(0,r.kt)("inlineCode",{parentName:"p"},"getters"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," and familiar methods use the abbreviations ",(0,r.kt)("inlineCode",{parentName:"p"},"set*()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"get*()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"is*()"),"and ",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()")," where ",(0,r.kt)("inlineCode",{parentName:"p"},"*")," is a list of characters conforming to the regular expression ",(0,r.kt)("inlineCode",{parentName:"p"},"\\$(A-Z)[a-zA-Z0-9_]*"),"."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"1.1.1.1")," For semantic purposes, we introduce ",(0,r.kt)("inlineCode",{parentName:"p"},"is*()")," as a representative of a method with read-access to a ",(0,r.kt)("inlineCode",{parentName:"p"},"boolean")," property."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"1.1.1.2")," ",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()")," will be used as a proxy-method for ",(0,r.kt)("inlineCode",{parentName:"p"},"set*()"),"."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},"1.1.2"),' This article mentions "physical existing" and "virtual" methods. In the context of the topic of this article, a "physical existingn" method\nrefers to a method that is available with the source code. A "virtual" method refers to a method that is resolved by\n',(0,r.kt)("inlineCode",{parentName:"p"},"PHP"),"'s magic method ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.oop5.overloading.php#object.call"},(0,r.kt)("inlineCode",{parentName:"a"},"__call")),". (In this regard ",(0,r.kt)("em",{parentName:"p"},"virtual accessors"),"\nand ",(0,r.kt)("a",{parentName:"p",href:"https://en.cppreference.com/w/cpp/language/virtual"},(0,r.kt)("inlineCode",{parentName:"a"},"virtual functions"))," share the similarity that the target function is not known during compile time respectively to its runtime engine.)"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"1.1.3")," ",(0,r.kt)("em",{parentName:"p"},"Iff")," means ",(0,r.kt)("em",{parentName:"p"},"If, and only if"),"."),(0,r.kt)("h2",{id:"2-introduction"},"2. Introduction"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Property Encapsulation")," in object-oriented programming is often connoted with implementing ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," for data,\nand falsely so with ",(0,r.kt)("strong",{parentName:"p"},"data hiding"),": Reducing the visibility of class-properties using access-modifiers like\n",(0,r.kt)("inlineCode",{parentName:"p"},"private")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"protected")," and later exposing the same with appropriate ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),"- and ",(0,r.kt)("inlineCode",{parentName:"p"},"set"),"-methods is by no means an act of hiding\ndata - it simply is encapsulation in its purest form and, even if rightly so applied - often such classes\nbenefit in no way from providing such methods. More so, if the data of a class changes\nand the interface is already used in the system (eventually leaking across module boundaries), it will be hard to change\nthe implementation without adding new code and leaving the old one in the class for backward compatibility, leading to code rot:\nInstead of simply refactoring classes to providing meaningful interfaces supporting abstractions and ",(0,r.kt)("strong",{parentName:"p"},"information hiding"),", classes tend do either grow or introduce breaking changes."),(0,r.kt)("p",null,"A complete set of ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," aligning with available properties may caress the ego of a developer or a project's coding\nstandards, but bloats the source code and reduces its readability. One may doubt that the conceptual context of an ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee")," is supported\nwith the following implementation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Employee.php"',title:'"Employee.php"'},"class Emplyoee\n{\n\n    private string $empId;\n\n    private string $name;\n\n    public function __construct(string $empId, string $name)\n    {\n        $this->setEmpId($empId);\n        $this->setName($name);\n    }\n\n    public function setEmpId(string $empId): void\n    {\n        $this->empId = $empId;\n    }\n\n    public function getEmpId(string $empId): string\n    {\n       return $this->empId;\n    }\n\n    public function setName(string $name): void\n    {\n        $this->name = $name;\n    }\n\n    public function getName(string $name): string\n    {\n        return $this->name;\n    }\n\n    // ...\n}\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee"),"-code has ",(0,r.kt)("strong",{parentName:"p"},"getters")," and ",(0,r.kt)("strong",{parentName:"p"},"setters")," exposing the existence of properties when following the ",(0,r.kt)("a",{parentName:"p",href:"#11-notation"},"notation")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"get*()"),"/ ",(0,r.kt)("inlineCode",{parentName:"p"},"set*()")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"is*()"),", helping data\nmappers and serializers when reconstituting or creating owning objects."),(0,r.kt)("p",null,"However, such methods don't promote the means of a model of a particular domain and not seldom are programmers tempted to implement logic or\nbehavior in places preceding such an API, because of fearing that functionality breaks when ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," unexpectedly implement logic for either updating (associated) data or\nusing constraints on the submitted data; this can lead to ",(0,r.kt)(i.A,{name:"anemic domain models",file:"ddd.anemicdomainmodel",mdxType:"GlosRef"}),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$employee = new Employee();\n\n$employee->setSalaryClass(Salary::EL13);\n$employee->setRole(CompanyRole::ITResearch);\n\n// instead of\n// $employee->promoteTo(CompanyRole::ITResearch);\n")),(0,r.kt)("p",null,"Often enough do we witness projects where business logic finds its way into ",(0,r.kt)(i.A,{name:"Facades",file:"sd.facade",mdxType:"GlosRef"}),",\nalbeit such business logic would have its rightful place in the ",(0,r.kt)(i.A,{name:"Entity",file:"sd.entity",mdxType:"GlosRef"})," itself (in this case, the ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee"),"-class)."),(0,r.kt)("p",null,"But does information hiding encourage a more verbose, intention revealing API? It is long known that visible implementation details will be re-used across module boundaries without further questioning their applicability ",(0,r.kt)(i.E,{name:"MOD",mdxType:"BibRef"}),": There is a chance that a programmer would rather use ",(0,r.kt)("inlineCode",{parentName:"p"},"setSalaryClass()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setRole()")," for implementing his/her own routine, instead of applying ",(0,r.kt)("inlineCode",{parentName:"p"},"promoteTo()"),", even if it would fit the use case."),(0,r.kt)("p",null,"The following approach has the advantage that, if such a form of ",(0,r.kt)("strong",{parentName:"p"},"information hiding")," is used, the API still conforms to the requirements of data mappers and other programs that use ",(0,r.kt)("inlineCode",{parentName:"p"},"getter")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setter")," with property discovery. Explicitly declared ",(0,r.kt)("a",{parentName:"p",href:"#43-guarding-constructor-arguments"},(0,r.kt)("strong",{parentName:"a"},"guards"))," can be given responsibility for putting constraints on data changes. The accessors will not be visible to a developer reading the source code file."),(0,r.kt)("h2",{id:"3-php-attributes"},"3. PHP Attributes"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.attributes.overview.php"},"Attributes")," were introduced with ",(0,r.kt)("strong",{parentName:"p"},"PHP8")," and can be\nused to provide metadata information with class implementations. While this was already possible with doc-block comments embedding annotations in previous\nversions of ",(0,r.kt)("strong",{parentName:"p"},"PHP"),", ",(0,r.kt)("strong",{parentName:"p"},"Attributes")," allow to do the same in a more formal context and with native support by the language itself.\nSimilar to ",(0,r.kt)("strong",{parentName:"p"},"Java"),", where ",(0,r.kt)("a",{parentName:"p",href:"https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/text/Annotation.html"},(0,r.kt)("strong",{parentName:"a"},"Annotations")),"\nhave their own type and can be embedded directly into code, ",(0,r.kt)("strong",{parentName:"p"},"PHP Attributes")," do not require doc-blocks,\nmaking parsers introducing expensive runtime behavior obsolete. PHP's ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/class.reflectionattribute.php"},"Reflection API")," allows for reading\nout ",(0,r.kt)("strong",{parentName:"p"},"Attributes")," preceding classes, methods or properties."),(0,r.kt)("p",null,"For this article, we define two classes that serve as ",(0,r.kt)("em",{parentName:"p"},(0,r.kt)("strong",{parentName:"em"},"tagging Attributes")),": They will be used for identifying\nproperties that require ",(0,r.kt)("strong",{parentName:"p"},"getters")," and ",(0,r.kt)("strong",{parentName:"p"},"setters")," to be available as part of their host's interface."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Setter.php"',title:'"Setter.php"'},"#[Attribute]\nclass Setter\n{\n}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Getter.php"',title:'"Getter.php"'},"#[Attribute]\nclass Getter\n{\n}\n")),(0,r.kt)("h2",{id:"4-the-accessortrait"},"4. The ",(0,r.kt)("inlineCode",{parentName:"h2"},"AccessorTrait")),(0,r.kt)("p",null,"Any client interested in updating or querying data of an object whose properties are attributed with ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]")," and\n",(0,r.kt)("inlineCode",{parentName:"p"},"#[Getter]")," should be able to use particular ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),"- and ",(0,r.kt)("inlineCode",{parentName:"p"},"set"),"-methods. For this purpose, we will use a\n",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.oop5.traits.php"},(0,r.kt)("inlineCode",{parentName:"a"},"Trait")),": This allows code re-usabilty without using inheritance or object composition."),(0,r.kt)("p",null,"In this ",(0,r.kt)("inlineCode",{parentName:"p"},"Trait"),", we need to implement PHP's ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.oop5.overloading.php#object.call"},(0,r.kt)("inlineCode",{parentName:"a"},"__call()")),", allowing us to capture\nany method call that was not treated by an actual, physical implementation of this method."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The following version of ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," will only showcase the basic implementation. For a complete\nversion of this code, refer to ",(0,r.kt)("a",{parentName:"p",href:"https://quant-php.dev/docs/packages/quant/core"},"quant/core"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="AccessorTrait.php"',title:'"AccessorTrait.php"'},'trait AccessorTrait\n{\n    public function __call($method, $args): mixed\n    {\n        if (($isSetter = str_starts_with($method, "set")) ||\n            str_starts_with($method, "get")) {\n\n            $property = lcfirst(substr($method, 3));\n\n            if ($isSetter) {\n                if ($this->hasSetterAttribute($property)) {\n                    $this->applyFromSetter($property, $args[0]);\n                    return $this;\n                }\n            } else  {\n                if ($this->hasGetterAttribute($property)) {\n                    return $this->$property;\n                }\n            }\n        }\n\n        throw new BadMethodCallException("$method not found.");\n    }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"__call()")," will be available to the host using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Trait"),": Whenever a method is called that is not available on the\ntarget object, ",(0,r.kt)("strong",{parentName:"p"},"PHP")," will take care of passing the requested method-name along with any submitted arguments to this method. In our case,\n",(0,r.kt)("inlineCode",{parentName:"p"},"__call")," inspects the requested method-name for a ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),"-/",(0,r.kt)("inlineCode",{parentName:"p"},"set"),"-prefix, and, if available, queries the host for properties\nattributed with ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Getter]"),". Such properties can also be declared by using ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.oop5.decon.php#language.oop5.decon.constructor.promotion"},(0,r.kt)("strong",{parentName:"a"},"Constructor Property Promotion")),"\nwith one or more attributes preceding them."),(0,r.kt)("h3",{id:"41-hosting-the-accessortrait"},"4.1 Hosting the ",(0,r.kt)("inlineCode",{parentName:"h3"},"AccessorTrait")),(0,r.kt)("p",null,"As a requirement, the ",(0,r.kt)("inlineCode",{parentName:"p"},"$empId")," of the previously introduced ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee"),"-class should be immutable, but readable with ",(0,r.kt)("inlineCode",{parentName:"p"},"getEmpId()"),".\nUsing the ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Getter]"),"-Attribute along with ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/language.oop5.decon.php#language.oop5.decon.constructor.promotion"},(0,r.kt)("strong",{parentName:"a"},"Constructor Property Promotion")),", our implementation looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Employee.php"',title:'"Employee.php"'},'class Employee {\n\n    use AccessorTrait;\n\n    #[Getter]\n    private string $name = "John Smith";\n\n    public function __construct(\n        #[Getter]\n        private string $empId\n    ) {\n    }\n}\n')),(0,r.kt)("p",null,"Creating an instance and immediately accessing the ",(0,r.kt)("inlineCode",{parentName:"p"},"$empId")," declared as ",(0,r.kt)("inlineCode",{parentName:"p"},"private")," is now possible since ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee")," uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$employee = new Employee("87i-dsd-89z-978");\n$employe->getEmpId(); // returns "87i-dsd-89z-978"\n')),(0,r.kt)("p",null,"Also, read-access to ",(0,r.kt)("inlineCode",{parentName:"p"},"$name")," is given by calling ",(0,r.kt)("inlineCode",{parentName:"p"},"getName()"),"."),(0,r.kt)("p",null,"Conversely, a call to ",(0,r.kt)("inlineCode",{parentName:"p"},"setEmpId()")," throws a ",(0,r.kt)("inlineCode",{parentName:"p"},"BadMethodCallException"),": It's neither defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee"),", nor is it\nconsidered with ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait::__call()")," since the ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]"),"-attribute for its property is missing."),(0,r.kt)("p",null,"When we want to make the ",(0,r.kt)("inlineCode",{parentName:"p"},"$name")," property of ",(0,r.kt)("inlineCode",{parentName:"p"},"Employee")," mutable, we only need to add the ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]"),"-attribute to its property; this provides\nthe availability of ",(0,r.kt)("inlineCode",{parentName:"p"},"setName()"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Employee.php"',title:'"Employee.php"'},'class Employee {\n\n    use AccessorTrait;\n\n    #[Setter] #[Getter]\n    private string $name = "John Smith";\n\n    public function __construct(\n        #[Getter]\n        private string $empId\n    ) {\n    }\n}\n')),(0,r.kt)("p",null,"Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"$name")," is now possible by calling ",(0,r.kt)("inlineCode",{parentName:"p"},"setName()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$employee = new Employee("87i-dsd-89z-978");\n$employe->setName("Thomas Anderson");\n')),(0,r.kt)("p",null,"Instead of configuring ",(0,r.kt)("strong",{parentName:"p"},"individual properties")," of a target class, it is also possible to ",(0,r.kt)("strong",{parentName:"p"},"use the attributes on class level"),": The accessors configured with their attribute-representation\nwill then automatically be available ",(0,r.kt)("strong",{parentName:"p"},"for all")," properties of the class. An example will be given ",(0,r.kt)("a",{parentName:"p",href:"#44-modifying-access-to-getters-and-setters"},"below"),"."),(0,r.kt)("h3",{id:"42-conditional-updates-of-properties-with-guards"},"4.2 Conditional Updates of Properties with Guards"),(0,r.kt)("p",null,"Since physical code for ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," is not available, developers still need to make sure that data passed to ",(0,r.kt)("em",{parentName:"p"},"virtual setters"),"\ndoes not violate specific criteria that would otherwise leave target objects in an invalid state. Thus, the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," proxies\n",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()"),"-methods (",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()")," conforming to the ",(0,r.kt)("a",{parentName:"p",href:"#11-notation"},"naming conventions")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"get")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"set"),").\nThese methods are looked up in the classes using the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," (or extending a hosting class) and -\nif existing, are called with the value that is provided as the ",(0,r.kt)("em",{parentName:"p"},"new")," value for the target property.\n",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()")," can then validate the submitted argument and return a value that is actually used with ",(0,r.kt)("inlineCode",{parentName:"p"},"set*()"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Employee.php"',title:'"Employee.php"'},'class Employee {\n\n    use AccessorTrait;\n\n    #[Setter] #[Getter]\n    private string $name = "John Smith";\n\n    /**\n     *  @throws ValueError\n     */\n    protected function applyName(string $value): string\n    {\n        if ($value === "") {\n            throw new ValueError("Empty name is not allowed");\n        }\n\n        if ($value === "John Smith") {\n            return $this->name;\n        }\n\n        return $value;\n    }\n}\n')),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," implements a method similar to the following ",(0,r.kt)("inlineCode",{parentName:"p"},"applyFromSetter()"),"-method, making sure an ",(0,r.kt)("inlineCode",{parentName:"p"},"apply"),"-method gets correctly mapped to a property:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="AccessorTrait.php"',title:'"AccessorTrait.php"'},'\npublic function __call($method, $args): mixed\n{\n    // ...\n\n    if ($isSetter) {\n        if ($this->hasSetterAttribute($property)) {\n            $this->applyFromSetter($property, $args[0]);\n            return $this;\n        }\n    }\n\n    // ...\n}\n\nprivate function applyFromSetter(\n    string $property,\n    mixed $value\n): void {\n    $applier = "apply" . ucfirst($property);\n\n    $newValue = $value;\n    if (method_exists($this, $applier)) {\n        $newValue = $this->{$applier}($value);\n    }\n    $this->$property = $newValue;\n}\n\n')),(0,r.kt)("p",null,"Iff an  ",(0,r.kt)("inlineCode",{parentName:"p"},"apply*()"),"-method for the targeted property is available, such a  ",(0,r.kt)("strong",{parentName:"p"},"guard")," is applied to the ",(0,r.kt)("inlineCode",{parentName:"p"},"$value"),"-argument,\nthen the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," uses its return value as the new value for the targeted property. If no ",(0,r.kt)("strong",{parentName:"p"},"guard")," is available, the original value\nwill be used as the new value."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The new value might by the same as the old value, making it difficult to determine whether the returning value is equal to\nthe value that was originally submitted to ",(0,r.kt)("inlineCode",{parentName:"p"},"set*()"),". If a distinction is required, an exception could be thrown or a user-defined\nbottom-value can be used, either of them containing information about the original, invalid value.")),(0,r.kt)("h3",{id:"43-guarding-constructor-arguments"},"4.3 Guarding constructor arguments"),(0,r.kt)("p",null,"To utilize the various ",(0,r.kt)("inlineCode",{parentName:"p"},"apply"),"-methods that might be available with the implementation, a constructor can invoke\nthe ",(0,r.kt)("inlineCode",{parentName:"p"},"applyProperties"),"-method available with the ",(0,r.kt)("strong",{parentName:"p"},"AccessorTrait"),": This will immediately apply any method guarding a property\nto the constructor argument, then assigning the computed value to it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"}," public function __construct(\n        private string $a,\n        #[Setter]\n        private string $b\n    ) {\n        $this->applyProperties([1 => $b]);\n    }\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"applyProperties")," expects a numeric array and will identify any property positionally. In the example above, the guard for\nthe class-property ",(0,r.kt)("inlineCode",{parentName:"p"},"$b")," will be invoked with the value submitted with the constructor argument ",(0,r.kt)("inlineCode",{parentName:"p"},"$b"),"."),(0,r.kt)("h3",{id:"44-modifying-access-to-getters-and-setters"},"4.4 Modifying access to ",(0,r.kt)("inlineCode",{parentName:"h3"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"h3"},"setters")),(0,r.kt)("p",null,"To modify the visibility of any accessor available through the ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Getter]")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]")," annotation, access configuration can be achieved\nby applying arguments to the attributes: ",(0,r.kt)("strong",{parentName:"p"},"PHP")," provides means to pass additional information to attributes as constructor arguments\nwhen ",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/reflectionattribute.newinstance"},(0,r.kt)("inlineCode",{parentName:"a"},"newInstance()"))," is invoked on the attribute's reflection representative."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"PHP allows for omitting a constructor in classes representing attributes. This does not prevent the Reflection API from reading such arguments out.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="Using tagging Arguments with Attributes"',title:'"Using',tagging:!0,Arguments:!0,with:!0,'Attributes"':!0},"#[Attribute(TaggingClass::TagName, AnotherTaggingClass::AnotherTag)]\n")),(0,r.kt)("p",null,"Using arguments as semantics, a set of user-defined modifiers can be used to further describe\nthe access level of a virtual ",(0,r.kt)("inlineCode",{parentName:"p"},"getter")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"setter"),"."),(0,r.kt)("p",null,"Consider the following implementation, where an enum ",(0,r.kt)("inlineCode",{parentName:"p"},"Modifier")," exists\nthat provides the values ",(0,r.kt)("inlineCode",{parentName:"p"},"PUBLIC"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PRIVATE"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"PROTECTED"),". Describing a class that has only ",(0,r.kt)("em",{parentName:"p"},"private")," ",(0,r.kt)("inlineCode",{parentName:"p"},"setters"),"\nand ",(0,r.kt)("em",{parentName:"p"},"public")," ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," can then be achieved by"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'#[Getter(Modifier::PUBLIC)]\n#[Setter(Modifier::PRIVATE)]\nclass A\n{\n    use AccessorTrait;\n\n    private string $value = "";\n}\n')),(0,r.kt)("p",null,"This will provide public access to ",(0,r.kt)("inlineCode",{parentName:"p"},"getValue()")," of instances of ",(0,r.kt)("inlineCode",{parentName:"p"},"A"),", but only private access to the corresponding ",(0,r.kt)("inlineCode",{parentName:"p"},"setter"),"\nof ",(0,r.kt)("inlineCode",{parentName:"p"},"$value"),". Thus, changing the values is reserved to ",(0,r.kt)("inlineCode",{parentName:"p"},"A")," itself. Changing ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter(Modifier::PRIVATE)]")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter(Modifier::PROTECTED)]")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter(Modifier::PUBLIC)]"),"\ngives then wider access to editing ",(0,r.kt)("inlineCode",{parentName:"p"},"$value"),"."),(0,r.kt)("p",null,"We can easily achieve attribute overriding with additional ",(0,r.kt)("em",{parentName:"p"},"property leveled")," attributes: If one wishes to\nprovide ",(0,r.kt)("inlineCode",{parentName:"p"},"protected")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"private")," access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"setter")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"$value"),", an additional attribute can be provided:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'#[Getter(Modifier::PUBLIC)]\n#[Setter(Modifier::PRIVATE)]\nclass A\n{\n    use AccessorTrait;\n\n    #[Setter(Modifier::PROTECTED)]\n    private string $value = "";\n}\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Since the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," implements any conceivable logic and behavior, additional user-defined modifiers like ",(0,r.kt)("inlineCode",{parentName:"p"},"Modifier::PACKAGE"),"\ncould be used for access based on namespace equality.")),(0,r.kt)("h3",{id:"45-inheritance-and-scoping"},"4.5 Inheritance and Scoping"),(0,r.kt)("p",null,"The implementation allows for using the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," in a class, and then all subclasses of this class can use\n",(0,r.kt)("inlineCode",{parentName:"p"},"#[Getter]")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"#[Setter]")," attributes for accessor automation."),(0,r.kt)("p",null," Since ",(0,r.kt)("inlineCode",{parentName:"p"},"Traits")," are basically code templates enabling horizontal code composition without affecting inheritance, the behavior with\nhosting classes is just like as if the code of the ",(0,r.kt)("inlineCode",{parentName:"p"},"Trait")," was actually physical part of the hosting class.\nThis proves challenging when"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"the the scope of the owner of the ",(0,r.kt)("inlineCode",{parentName:"li"},"setter")," / ",(0,r.kt)("inlineCode",{parentName:"li"},"getter")," needs to be resolved"),(0,r.kt)("li",{parentName:"ol"},"when modifiers such as ",(0,r.kt)("inlineCode",{parentName:"li"},"PROTECTED")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"PRIVATE")," are used and access of interested callers has to be resolved")),(0,r.kt)(s.cx,{title:"The Trait hosts __call and has to take care of finding attributed properties in subclasses. Scoping is also its responsibility.",mdxType:"Embed"},(0,r.kt)("img",{src:o})),(0,r.kt)("p",null,"Gaining information about the calling scope of magic methods ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/php/php-src/issues/9906"},"has already been discussed")," and\nresulted in an ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.php.net/rfc/access_scope_from_magic_accessors"},"RFC scheduled for 8.3"),"."),(0,r.kt)("p",null,"Since modifiers have to be treated in accordance to the language level behavior of PHP, using ",(0,r.kt)("inlineCode",{parentName:"p"},"debug_backtrace()"),"\nfor accessing runtime information on the call stack exposes required information about the callers and the callees."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},' $bt = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 3);\n if ($accessLevel === Modifier::PRIVATE && $bt[2]["class"] !== $declaringClass) {\n    return false;\n}\n')),(0,r.kt)("p",null,"This does not severely impact performance, but the need for accessing a rather expensive function belonging to the debugging domain\nshows that ",(0,r.kt)("strong",{parentName:"p"},"PHP")," can benefit from additional runtime information when magic methods are involved.\nFurther possible optimizations facilitating caching and production builds that make runtime evaluation unnecessary are discussed later in this article."),(0,r.kt)("h3",{id:"46-static-code-analysis"},"4.6 Static Code Analysis"),(0,r.kt)("p",null,"The implementation provides extensions for ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/phpstan/phpstan"},(0,r.kt)("strong",{parentName:"a"},"PHPStan"))," so that white-box tests on static code\nproperly resolves calls to virtual getters and setters."),(0,r.kt)("p",null,"To make this work,several classes have to be implemented. The most notable are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"PHPStan\\Reflection\\MethodReflection")," ",(0,r.kt)("br",null)," provides information about methods-calls intercepted by ",(0,r.kt)("inlineCode",{parentName:"p"},"__call"),". Of interest are the\nfunction variants returned for ",(0,r.kt)("inlineCode",{parentName:"p"},"set"),"- and ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),"-contexts which provide further information about valid parameter configurations and\nthe return value and its type for either ",(0,r.kt)("inlineCode",{parentName:"p"},"setter")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"getter"),": For a ",(0,r.kt)("inlineCode",{parentName:"p"},"setter"),", this must be the type of the property-declaring class itself; for a ",(0,r.kt)("inlineCode",{parentName:"p"},"getter"),",\nthe type of the configured property is required.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"PHPStan\\Reflection\\MethodsClassReflectionExtension")," ",(0,r.kt)("br",null)," A predefined interface for implementations facilitating ",(0,r.kt)("inlineCode",{parentName:"p"},"__call"),", ",(0,r.kt)("a",{parentName:"p",href:"https://phpstan.org/developing-extensions/class-reflection-extensions#methods-class-reflection-extensions"},"MethodsClassReflectionExtension"),"\ngreatly reduces the required effort (e.g. custom rules) for implementing constraints on magic method calls. For the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait"),", the logic\nrequired for the interface's ",(0,r.kt)("inlineCode",{parentName:"p"},"hasMethod()"),"/ ",(0,r.kt)("inlineCode",{parentName:"p"},"getMethod()")," is similar to that found within the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," itself,\nexcluding the code required for determining the calling scope, which is statically resolved by ",(0,r.kt)("strong",{parentName:"p"},"PHPStan"),"'s engine.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"PHPStan\\Rules\\Properties\\ReadWritePropertiesExtension")," ",(0,r.kt)("br",null)," This extension interface is used to describe always-read or always-written properties to prevent ",(0,r.kt)("inlineCode",{parentName:"p"},"never read")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"unused"),"\nwarnings.  The extension for ",(0,r.kt)("strong",{parentName:"p"},"quant")," checks whether the attribute's property is used with a class that uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait"),"\nand optimistically returns ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," for the ",(0,r.kt)("inlineCode",{parentName:"p"},"isAlwaysRead()"),"-, ",(0,r.kt)("inlineCode",{parentName:"p"},"isAlwaysWritten()"),"- and ",(0,r.kt)("inlineCode",{parentName:"p"},"isInitialized()"),"- checks."))),(0,r.kt)("h2",{id:"5-performance-considerations"},"5. Performance considerations"),(0,r.kt)("p",null,"The implementation details described in this article require logic and information to be evaluated at runtime, since\n",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," are only virtually existing, not physically: This affects performance to a certain degree which is\nexamined below."),(0,r.kt)("p",null,"In tests, the following functionality of the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," proved to have an impact on runtime performance: ",(0,r.kt)("a",{name:"performance_impacts"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Using the ",(0,r.kt)("a",{parentName:"li",href:"https://www.php.net/manual/en/book.reflection.php"},"Reflection API")," to query properties and classes for properties."),(0,r.kt)("li",{parentName:"ol"},"Deciding whether an callee's accessor is accessible based on the modifier-configuration of the attribute."),(0,r.kt)("li",{parentName:"ol"},"Scoping function calls from the class that hosts the trait to the classes that declare the property. E.g., if the property is declared ",(0,r.kt)("inlineCode",{parentName:"li"},"private"),", the ",(0,r.kt)("strong",{parentName:"li"},"owning class")," must be determined and used as the scope when setting the property.")),(0,r.kt)("h3",{id:"51-benchmark-test-cases"},"5.1 Benchmark Test Cases"),(0,r.kt)("p",null,"To get an idea of how the runtime of the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait")," compares to related implementations, the following Test Cases\nwere measured using ",(0,r.kt)("a",{parentName:"p",href:"https://phpbench.readthedocs.io/en/latest/index.html"},"phpbench"),", an open source benchmark tool for ",(0,r.kt)("strong",{parentName:"p"},"PHP"),":"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Calls to a ",(0,r.kt)("inlineCode",{parentName:"li"},"setter"),"-method physically existing on a class."),(0,r.kt)("li",{parentName:"ol"},"Calls to a method intercepted by ",(0,r.kt)("inlineCode",{parentName:"li"},"__call"),"."),(0,r.kt)("li",{parentName:"ol"},"Using ",(0,r.kt)("a",{parentName:"li",href:"https://www.doctrine-project.org/projects/annotations.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Doctrine\\Common\\Annotations::AnnotationReader"))," to parse Docblocks and read annotations, then intercept the method call by ",(0,r.kt)("inlineCode",{parentName:"li"},"__call"),"."),(0,r.kt)("li",{parentName:"ol"},"Using ",(0,r.kt)("inlineCode",{parentName:"li"},"AccessorTrait")," to get the Attribute of a property, then map the name of the property to a method-call intercepted by ",(0,r.kt)("inlineCode",{parentName:"li"},"__call"),"."),(0,r.kt)("li",{parentName:"ol"},"Using instances of a class hierarchy with multiple calls to physical existing ",(0,r.kt)("inlineCode",{parentName:"li"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"setters"),"."),(0,r.kt)("li",{parentName:"ol"},"The same as 5., but ",(0,r.kt)("inlineCode",{parentName:"li"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"setters")," are only virtually existing; the ",(0,r.kt)("inlineCode",{parentName:"li"},"AccessorTrait")," is part of the root-class.")),(0,r.kt)("p",null,"For 6., it is worth mentioning that the classes for the benchmark represent more complex use cases by using inheritance, access modifiers and the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait"),"\nhosted only on the root class, resulting in more operations when properties are looked up."),(0,r.kt)("h4",{id:"511-benchmark-settings"},"5.1.1 Benchmark Settings"),(0,r.kt)("p",null,"For each benchmark, a ",(0,r.kt)("a",{parentName:"p",href:"https://phpbench.readthedocs.io/en/latest/annotributes.html?highlight=revs#revolutions"},"Revolution")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"1000")," is used that gets ",(0,r.kt)("a",{parentName:"p",href:"https://phpbench.readthedocs.io/en/latest/annotributes.html?highlight=revs#iterations"},"iterated")," ",(0,r.kt)("inlineCode",{parentName:"p"},"5")," times.\nUsing a ",(0,r.kt)("a",{parentName:"p",href:"https://phpbench.readthedocs.io/en/latest/annotributes.html?highlight=revs#retrythreshold"},"retry-threshold")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"2")," narrows down the deviation for which samples are treated valid."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://phpbench.readthedocs.io/en/latest/annotributes.html?highlight=revs#warm-up"},"Warm Ups")," are skipped to make sure at least the first sample has the benchmarked code processed with the opcode-cache."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ vendor/bin/phpbench run Tests/Benchmarks --report=aggregate --retry-threshold=2\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Test Environment"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"System"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"OS"),(0,r.kt)("td",{parentName:"tr",align:null},"Microsoft Windows 11 Pro, V10.0.22621")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Hardware"),(0,r.kt)("td",{parentName:"tr",align:null},"AMD Ryzen 9 5900X (amd64), 64GB RAM")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Docker provider"),(0,r.kt)("td",{parentName:"tr",align:null},"docker 20.10.21")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Runtime"),(0,r.kt)("td",{parentName:"tr",align:null},"php PHP8.2.3,  nginx-fpm, xdebug \u274c, opcache \u2714")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DDEV version"),(0,r.kt)("td",{parentName:"tr",align:null},"v1.21.6"))))),(0,r.kt)("h3",{id:"52-results"},"5.2 Results"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"benchmark"),(0,r.kt)("th",{parentName:"tr",align:null},"time"),(0,r.kt)("th",{parentName:"tr",align:null},"rstdev"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1. ",(0,r.kt)("inlineCode",{parentName:"td"},"setA(string $s)")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"4.956\u03bcs")),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.04%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"2. ",(0,r.kt)("inlineCode",{parentName:"td"},"__call: _$this->{$method} = $args[0];")),(0,r.kt)("td",{parentName:"tr",align:null},"5.114\u03bcs"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.09%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"3. ",(0,r.kt)("inlineCode",{parentName:"td"},"Doctrine\\Common\\Annotations::AnnotationReader -> __call()")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"1.689ms")),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.25%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"4. ",(0,r.kt)("inlineCode",{parentName:"td"},"AccessorTrait::getBPublic()")),(0,r.kt)("td",{parentName:"tr",align:null},"18.566\u03bcs"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.54%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"5. implemented getters / setters"),(0,r.kt)("td",{parentName:"tr",align:null},"16.397\u03bcs"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.15%")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"6. attributed getters / setters"),(0,r.kt)("td",{parentName:"tr",align:null},"60.786\u03bcs"),(0,r.kt)("td",{parentName:"tr",align:null},"\xb11.04%")))),(0,r.kt)("h3",{id:"53-observations"},"5.3 Observations"),(0,r.kt)("p",null,"Not surprisingly, the native implementation of a setter (1.) is the fastest with ",(0,r.kt)("strong",{parentName:"p"},"4.956\u03bcs"),", with the magic method (2.) only slightly slower."),(0,r.kt)("p",null,"The ",(0,r.kt)("strong",{parentName:"p"},"AnnotationReader")," is the slowest benchmark with ",(0,r.kt)("strong",{parentName:"p"},"1.689ms"),", obviously due to the fact that text parsers are involved, conversely to (6.),\nwhere attribute parsing is natively implemented: The benchmark for the complex test case using the ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTraits")," requires ",(0,r.kt)("strong",{parentName:"p"},"60.786\u03bcs")," to finish."),(0,r.kt)("p",null,"This is roughly 3.75 times slower than the benchmark for the code implementing physical methods."),(0,r.kt)("h4",{id:"531-memory-consumption"},"5.3.1 Memory Consumption"),(0,r.kt)("p",null,"It should be obvious that, beginning with a given threshold of ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"n"),(0,r.kt)("mo",{parentName:"mrow"},"\u2208"),(0,r.kt)("msub",{parentName:"mrow"},(0,r.kt)("mi",{parentName:"msub",mathvariant:"double-struck"},"N"),(0,r.kt)("mrow",{parentName:"msub"},(0,r.kt)("mo",{parentName:"mrow"},">"),(0,r.kt)("mn",{parentName:"mrow"},"1")))),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n \\in \\N_{>1}")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.5782em",verticalAlign:"-0.0391em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.kt)("span",{parentName:"span",className:"mrel"},"\u2208"),(0,r.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8663em",verticalAlign:"-0.1774em"}}),(0,r.kt)("span",{parentName:"span",className:"mord"},(0,r.kt)("span",{parentName:"span",className:"mord mathbb"},"N"),(0,r.kt)("span",{parentName:"span",className:"msupsub"},(0,r.kt)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.3011em"}},(0,r.kt)("span",{parentName:"span",style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"}},(0,r.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,r.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,r.kt)("span",{parentName:"span",className:"mord mtight"},(0,r.kt)("span",{parentName:"span",className:"mrel mtight"},">"),(0,r.kt)("span",{parentName:"span",className:"mord mtight"},"1"))))),(0,r.kt)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,r.kt)("span",{parentName:"span",className:"vlist-r"},(0,r.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.1774em"}},(0,r.kt)("span",{parentName:"span"})))))))))),",  ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"n")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n")))))," classes using physical getters and setters use up more memory than ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"n")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n")))))," classes\nthat discard physical code and use a ",(0,r.kt)("inlineCode",{parentName:"p"},"Trait")," instead. The article is guilty of not providing a value for ",(0,r.kt)("span",{parentName:"p",className:"math math-inline"},(0,r.kt)("span",{parentName:"span",className:"katex"},(0,r.kt)("span",{parentName:"span",className:"katex-mathml"},(0,r.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,r.kt)("semantics",{parentName:"math"},(0,r.kt)("mrow",{parentName:"semantics"},(0,r.kt)("mi",{parentName:"mrow"},"n")),(0,r.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"n")))),(0,r.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,r.kt)("span",{parentName:"span",className:"base"},(0,r.kt)("span",{parentName:"span",className:"strut",style:{height:"0.4306em"}}),(0,r.kt)("span",{parentName:"span",className:"mord mathnormal"},"n")))))," where memory consumption would start to become noticeable: In the given\ntest cases, memory consumption was negligible and is therefor not listed."),(0,r.kt)("h2",{id:"6-conclusion"},"6. Conclusion"),(0,r.kt)("p",null,"Reducing the physical visibility of getters and setters can have the effect that developers take more advantage of words and terms\nconceptually related to an entity when defining methods, instead of placing such methods in facades\noperating on setters and getters of such entities. When reducing the relevance of accessors, developers may  be encouraged to\nwork more closely with the inherent responsibility of such an entity, instead of simply interfacing its properties.\nThe code becomes more intention revealing, more readable, and the entity's purpose is communicated with its method names."),(0,r.kt)("p",null,"With the benchmarks executed for the various testcases, it shows that physical existing code has runtime benefits, but\nimpacts memory consumption, conversely to the implementation that only uses magic methods. Although the memory consumption\nfor the given benchmarks are negligible, physical implementations greatly benefit from the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.php.net/manual/en/intro.opcache.php"},(0,r.kt)("strong",{parentName:"a"},"opcode cache")),", whereas the logic evaluated with ",(0,r.kt)("inlineCode",{parentName:"p"},"__call")," and the\nvirtual ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," cannot be cached in the same way the physical existing ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters")," are.\nIn a system whose codebase requires ",(0,r.kt)("inlineCode",{parentName:"p"},"getters")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"setters"),", but where those accessors are not frequently used, the system will\nbenefit from lower memory consumption."),(0,r.kt)("p",null,"With regards to particular caching mechanisms, it should be easy to provide builds of the code that uses such ",(0,r.kt)("inlineCode",{parentName:"p"},"AccessorTrait"),"s,\nresulting in classes that physically provide getters and setters, increasing runtime execution. However, if custom modifiers\nlike the above mentioned ",(0,r.kt)("a",{parentName:"p",href:"#44-modifying-access-to-getters-and-setters"},(0,r.kt)("inlineCode",{parentName:"a"},"Modifier::PACKAGE"))," are used, any implementing builder would have the responsibility to properly generate code based on the given information, to prevent accidentally exposure of data."),(0,r.kt)("p",null,"An attempt to provide native support for accessor automation is currently being made with ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.php.net/rfc/property-hooks"},(0,r.kt)("strong",{parentName:"a"},"PHP RFC"),": Property Hooks"),"\ntargeted for PHP 8.3. The RFC is derived from Nikita Popov's work on ",(0,r.kt)("a",{parentName:"p",href:"https://wiki.php.net/rfc/property_accessors"},"PHP RFC: Property Accessors"),"."),(0,r.kt)("hr",null),(0,r.kt)("h5",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://quant-php.dev/docs/packages/quant/core"},(0,r.kt)("strong",{parentName:"a"},"quant/core"),": ",(0,r.kt)("inlineCode",{parentName:"a"},"AccessorTrait")," documentation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/quant-php/quant"},(0,r.kt)("strong",{parentName:"a"},"quant/quant"),": ",(0,r.kt)("inlineCode",{parentName:"a"},"AccessorTrait")," repository")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/quant-php/core/tree/main/Tests/Benchmarks"},(0,r.kt)("strong",{parentName:"a"},"quant/core"),":",(0,r.kt)("inlineCode",{parentName:"a"}," AccessorTrait")," Benchmark source code")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://wiki.php.net/rfc/access_scope_from_magic_accessors"},(0,r.kt)("strong",{parentName:"a"},"PHP RFC"),": Access Scope from Magic Accessors")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/php/php-src/pull/6873"},(0,r.kt)("strong",{parentName:"a"},"php/php-src"),": Basic accessors implementation (WIP)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://wiki.php.net/rfc/property-hooks"},(0,r.kt)("strong",{parentName:"a"},"PHP RFC"),": Property Hooks")," (derived from ",(0,r.kt)("a",{parentName:"li",href:"https://wiki.php.net/rfc/property_accessors"},"PHP RFC: Property Accessors"),")")))}k.isMDXComponent=!0},2480:()=>{}}]);